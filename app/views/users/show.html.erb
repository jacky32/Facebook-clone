<%= turbo_frame_tag "main" do %>
  <div id="profile" data-controller="user">
    <div id="user-basic">
      <div id="user-background">
        Background picture
      </div>
      <div id="user-info">
        <div id="user-profile-pic"><%= show_svg(@user.get_profile_picture)%></div>
        <div id="user-instant">
          <div id="user-name"><%= @user.name %></div>
          <div id="user-friend-number">
            <% if @friends_count == 1 %>
              1 friend
            <% else %>
              <%= @friends_count %> friends
            <% end %>
            <div id="user-mutual-friends-number">
              <% unless current_user == @user %>
                <% if current_user.mutual_friends(@user).nil? %>
                  0 mutual friends
                <% elsif current_user.mutual_friends(@user).count == 1 %>
                  1 mutual friend
                <% else %>
                  <%= current_user.mutual_friends(@user).count %> mutual friends
                <% end %>
              <% end %>
            </div>
          </div>
          <div id="user-friend-pics">
            <% @friends.first(8).each_with_index do |friend, index| %>
              <% if index < 7 %>
                <%= link_to friend, style: "z-index: #{20-index}" do %>
                  <%= show_svg(friend.get_profile_picture)%>
                <% end %>
              <% else %>
                <div id="user-friend-last-pic" data-change="friends" data-user="<%= @user.id %>" data-action="click->user#swap click->user#changeActive" style="z-index: 13">
                  <%= show_svg(friend.get_profile_picture)%>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
        <div id="user-actions" class="buttons">
          <% if @user == current_user %>
            <div id="user-actions-edit-info" class="button">Edit profile</div>
          <% else %>
            <% unless current_user.friends_with?(@user) %>
              <div id="user-actions-add-friend" class="button">Add friend</div>
            <% end %>
            <div id="user-actions-send-message" class="button">Send message</div>
          <% end %>
        </div>
      </div>
      <div id="user-header">
        <div id="user-header-posts" data-user-target="posts" class="button active" data-change="posts" data-user="<%= @user.id %>" data-action="click->user#swap click->user#changeActive">
          Posts
        </div>
        <div id="user-header-about" data-user-target="about" class="button" data-change="about" data-user="<%= @user.id %>" data-action="click->user#swap click->user#changeActive">
          About
        </div>
        <div id="user-header-friends" data-user-target="friends" class="button" data-change="friends" data-user="<%= @user.id %>" data-action="click->user#swap click->user#changeActive">
          Friends
        </div>
      </div>
    </div>

    <%= turbo_frame_tag id="profile-content", src:get_profile_path(change: "posts", id: @user) do %>
      <div class="spinner-background">
        <div class="lds-dual-ring"></div>
      </div>
    <% end %>
  </div>
<% end %>